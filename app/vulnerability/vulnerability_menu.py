#!/usr/bin/env python3
# app/vulnerability/vulnerability_menu.py

import sys
import os

BASE_DIR = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
sys.path.insert(0, BASE_DIR)
sys.path.insert(0, os.path.join(BASE_DIR, 'app'))

from config import C_OK, C_WARN, C_ERR, C_RESET, C_INFO, C_TITLE
from utils import Logger, pause, clear_screen, InputValidator

def run_vulnerability_menu():
    """Vulnerability Assessment Main Menu"""
    
    while True:
        clear_screen()
        print(f"\n{C_TITLE}╔══════════════════════════════════════════╗")
        print(f"║     VULNERABILITY ASSESSMENT MENU        ║")
        print(f"╚══════════════════════════════════════════╝{C_RESET}\n")
        
        print(f"{C_INFO}  [1]  Web Vulnerability Scanner{C_RESET}")
        print(f"{C_INFO}  [2]  SQL Injection Tester{C_RESET}")
        print(f"{C_INFO}  [3]  XSS Scanner{C_RESET}")
        print(f"{C_INFO}  [4]  SSL/TLS Analyzer{C_RESET}")
        print(f"{C_INFO}  [5]  CVE Database Lookup{C_RESET}")
        print(f"\n{C_WARN}  [0]  Back to Main Menu{C_RESET}\n")
        
        choice = InputValidator.get_choice()
        
        if choice == '0':
            return
        elif choice == '1':
            run_web_scanner()
        elif choice == '2':
            run_sql_tester()
        elif choice == '3':
            run_xss_scanner()
        elif choice == '4':
            run_ssl_analyzer()
        elif choice == '5':
            run_cve_lookup()
        else:
            Logger.error("Invalid choice!")
            pause()

def run_web_scanner():
    """Launch Web Vulnerability Scanner"""
    try:
        from vulnerability.web_scanner import WebVulnScanner
        scanner = WebVulnScanner()
        scanner.run()
    except ImportError as e:
        Logger.error(f"Web Scanner module not found: {e}")
        pause()
    except Exception as e:
        Logger.error(f"Error running Web Scanner: {e}")
        pause()

def run_sql_tester():
    """Launch SQL Injection Tester"""
    try:
        from vulnerability.sql_injection import SQLInjectionTester
        tester = SQLInjectionTester()
        tester.run()
    except ImportError as e:
        Logger.error(f"SQL Injection module not found: {e}")
        pause()
    except Exception as e:
        Logger.error(f"Error running SQL Tester: {e}")
        pause()

def run_xss_scanner():
    """Launch XSS Scanner"""
    try:
        from vulnerability.xss_scanner import XSSScanner
        scanner = XSSScanner()
        scanner.run()
    except ImportError as e:
        Logger.error(f"XSS Scanner module not found: {e}")
        pause()
    except Exception as e:
        Logger.error(f"Error running XSS Scanner: {e}")
        pause()

def run_ssl_analyzer():
    """Launch SSL/TLS Analyzer"""
    try:
        from vulnerability.ssl_tls_analyzer import SSLAnalyzer
        analyzer = SSLAnalyzer()
        analyzer.run()
    except ImportError as e:
        Logger.error(f"SSL Analyzer module not found: {e}")
        pause()
    except Exception as e:
        Logger.error(f"Error running SSL Analyzer: {e}")
        pause()

def run_cve_lookup():
    """Launch CVE Database Lookup"""
    try:
        from vulnerability.cve_checker import CVEChecker
        checker = CVEChecker()
        checker.run()
    except ImportError as e:
        Logger.error(f"CVE Checker module not found: {e}")
        pause()
    except Exception as e:
        Logger.error(f"Error running CVE Checker: {e}")
        pause()

if __name__ == "__main__":
    run_vulnerability_menu()
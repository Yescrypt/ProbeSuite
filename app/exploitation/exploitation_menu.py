#!/usr/bin/env python3
# app/exploitation/exploitation_menu.py - Exploitation Main Menu

import sys
import os
import time

BASE_DIR = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
sys.path.insert(0, BASE_DIR)

from config import C_OK, C_WARN, C_ERR, C_RESET, C_INFO, C_TITLE
from utils import Logger, pause, clear_screen, InputValidator

def run_exploitation_menu():
    """Main exploitation menu"""
    while True:
        clear_screen()
        print(f"\n{C_TITLE}╔══════════════════════════════════════════╗")
        print(f"║            EXPLOITATION                  ║")
        print(f"╚══════════════════════════════════════════╝{C_RESET}\n")
        
        print(f"{C_INFO}  [1]  Metasploit Integration{C_RESET}")
        print(f"{C_INFO}  [2]  SQLMap (SQL Injection){C_RESET}")
        print(f"{C_INFO}  [3]  Reverse Shell Generator{C_RESET}")
        print(f"{C_INFO}  [4]  Payload Generator{C_RESET}")
        print(f"{C_INFO}  [5]  Custom Exploit Runner{C_RESET}")
        print(f"{C_INFO}  [6]  Password Cracker{C_RESET}")
        print(f"\n{C_WARN}  [0]  Back{C_RESET}\n")
        
        choice = InputValidator.get_choice()
        
        if choice == '0':
            return
        elif choice == '1':
            run_metasploit()
        elif choice == '2':
            run_sqlmap()
        elif choice == '3':
            run_reverse_shell_gen()
        elif choice == '4':
            run_payload_gen()
        elif choice == '5':
            run_custom_exploit()
        elif choice == '6':
            run_password_cracker()
        else:
            Logger.error("Invalid choice!")
            time.sleep(1)

def run_metasploit():
    """Launch Metasploit Integration"""
    try:
        from metasploit_runner import MetasploitRunner
        runner = MetasploitRunner()
        runner.run()
    except ImportError as e:
        Logger.error("Metasploit runner module not found!")
        Logger.warning(f"Error: {e}")
        Logger.info("Please ensure metasploit_runner.py exists in app/exploitation/")
        pause()
    except Exception as e:
        Logger.error(f"Error: {e}")
        pause()

def run_sqlmap():
    """Launch SQLMap"""
    try:
        from sqlmap_runner import SQLMapRunner
        runner = SQLMapRunner()
        runner.run()
    except ImportError as e:
        Logger.error("SQLMap runner module not found!")
        Logger.warning(f"Error: {e}")
        Logger.info("Please ensure sqlmap_runner.py exists in app/exploitation/")
        pause()
    except Exception as e:
        Logger.error(f"Error: {e}")
        pause()

def run_reverse_shell_gen():
    """Launch Reverse Shell Generator"""
    try:
        from reverse_shell_gen import ReverseShellGenerator
        generator = ReverseShellGenerator()
        generator.run()
    except ImportError as e:
        Logger.error("Reverse shell generator module not found!")
        Logger.warning(f"Error: {e}")
        Logger.info("Please ensure reverse_shell_gen.py exists in app/exploitation/")
        pause()
    except Exception as e:
        Logger.error(f"Error: {e}")
        pause()

def run_payload_gen():
    """Launch Payload Generator"""
    try:
        from payload_generator import PayloadGenerator
        generator = PayloadGenerator()
        generator.run()
    except ImportError as e:
        Logger.error("Payload generator module not found!")
        Logger.warning(f"Error: {e}")
        Logger.info("Please ensure payload_generator.py exists in app/exploitation/")
        pause()
    except Exception as e:
        Logger.error(f"Error: {e}")
        pause()

def run_custom_exploit():
    """Launch Custom Exploit Runner"""
    try:
        from custom_exploit import CustomExploitRunner
        runner = CustomExploitRunner()
        runner.run()
    except ImportError as e:
        Logger.error("Custom exploit runner module not found!")
        Logger.warning(f"Error: {e}")
        Logger.info("Please ensure custom_exploit.py exists in app/exploitation/")
        pause()
    except Exception as e:
        Logger.error(f"Error: {e}")
        pause()

def run_password_cracker():
    """Launch Password Cracker"""
    try:
        from password_cracker import PasswordCracker
        cracker = PasswordCracker()
        cracker.run()
    except ImportError as e:
        Logger.error("Password cracker module not found!")
        Logger.warning(f"Error: {e}")
        Logger.info("Please ensure password_cracker.py exists in app/exploitation/")
        pause()
    except Exception as e:
        Logger.error(f"Error: {e}")
        pause()

if __name__ == "__main__":
    run_exploitation_menu()